# Grasp Parameters V3
# All heights are relative offsets unless otherwise specified

grasp:
  # Height offsets (relative to grasp point)
  pre_grasp_offset_z: 0.15        # Distance above grasp point for approach
  grasp_offset_z: 0.005           # Offset from cube center (0.5cm ABOVE center to grasp middle of cube)
  lift_offset_z: 0.15             # Distance above grasp after grasping
  retreat_offset_z: 0.20          # Safe height before returning home
  
  # Gripper orientation (Roll-Pitch-Yaw in radians)
  gripper_orientation:
    roll: 3.14159   # π (gripper pointing down)
    pitch: 0.0
    yaw: 0.0
  
  # Grasp candidates: yaw angles (radians)
  candidates:
    enable: true
    yaw_angles: [0.0, 1.5708, 3.14159, 4.71239]  # 0°, 90°, 180°, 270°
    # Approach directions: [[x_offset, y_offset], ...]
    # Only vertical approach (no side pushes)
    approach_directions: [
      [0.0, 0.0]       # From top (straight down ONLY)
    ]
    max_candidates: 8
  
  # Cartesian path parameters
  cartesian:
    step_size: 0.005              # 5mm resolution
    jump_threshold: 0.0           # No joint space jumps
    min_fraction: 0.70            # 70% completeness required (relaxed for better success rate)
    
  # Two-stage descent parameters
  approach_stages:
    pre_contact_height: 0.10      # Stop 10cm above target (more clearance for planning)
    final_descent_speed_factor: 0.3  # Slower speed for final descent (30% of normal)

# Gripper control parameters
gripper:
  # Opening width (meters)
  open_width: 0.08   # Fully open
  close_width: 0.041 # Grasp width for 45mm cube (41mm = slightly wider for better grip stability)
  
  # Control parameters
  max_effort: 150.0  # Maximum gripper force (Newtons) - increased from 50 to 150 for better grip
  speed: 0.1         # Gripper movement speed (m/s)
  
  # Grasp quality parameters
  epsilon_inner: 0.005  # Inner tolerance for successful grasp
  epsilon_outer: 0.005  # Outer tolerance for successful grasp

# State machine timing
timing:
  wait_after_plan: 0.5      # Wait after planning (seconds)
  wait_after_execute: 1.0   # Wait after execution (seconds)
  gripper_close_delay: 0.5  # Wait before closing gripper (seconds)
  
# Failure handling and retry logic
failure_handling:
  max_planning_retries: 3        # Retries per stage: (1) time, (2) tolerance, (3) planner
  max_candidate_retries: 8       # Maximum number of candidate attempts
  step_downsample_factor: 2      # Reduce step size by this factor in fallback
  distance_scale: 0.8            # Scale approach distance in fallback (0-1)
  fallback_planner: "RRTstar"    # Fallback if RRTConnect fails

# Environment constraints
environment:
  table_height: 0.0              # Table surface in base frame (meters)
  safety_margin_z: 0.08          # Minimum height above table (meters)
  cube_half_size: 0.0225         # Half size of 45mm cube (0.045m / 2 = 0.0225m)
  enable_table_collision: true   # Add table as collision object
  table_dimensions:
    x: 1.0
    y: 1.0
    thickness: 0.05

# Target pose interface specification
interface:
  target_cube_pose_frame: panda_link0
  target_semantic: "cube_center"  # /target_cube_pose is always cube center
  normalization: "internal"       # Z clamping done internally, not required upstream
  retry_delay: 1.0          # Delay between retries (seconds)
  backoff_multiplier: 1.5   # Increase delay by this factor each retry
