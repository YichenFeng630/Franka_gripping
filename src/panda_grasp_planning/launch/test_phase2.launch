<?xml version="1.0"?>
<launch>
  <!-- 
    Phase 2 Test Launch File
    Complete grasp pipeline with pose generation and execution.
    
    Prerequisites:
    - Gazebo and MoveIt must be running:
      roslaunch franka_zed_gazebo moveit_gazebo_panda.launch
  -->

  <arg name="debug" default="false" />
  <arg name="output" default="screen" />
  <arg name="use_gripper" default="false" doc="Enable real gripper control (false for simulation)" />
  <arg name="auto_execute" default="true" doc="Automatically execute grasp sequence when poses are received" />
  
  <!-- Load grasp parameters -->
  <rosparam command="load" file="$(find panda_grasp_planning)/config/grasp_params.yaml" />
  
  <!-- Load planning parameters -->
  <rosparam command="load" file="$(find panda_grasp_planning)/config/planning_params.yaml" />

  <!-- Grasp Pose Generator Node -->
  <node name="grasp_pose_generator" 
        pkg="panda_grasp_planning" 
        type="grasp_pose_generator_node.py" 
        output="$(arg output)"
        respawn="false">
    <param name="debug" value="$(arg debug)" />
  </node>

  <!-- Grasp Pipeline Node -->
  <node name="grasp_pipeline" 
        pkg="panda_grasp_planning" 
        type="grasp_pipeline_node.py" 
        output="$(arg output)"
        respawn="false">
    <param name="use_gripper" value="$(arg use_gripper)" />
    <param name="auto_execute" value="$(arg auto_execute)" />
    <param name="debug" value="$(arg debug)" />
  </node>

  <!-- Optional: RViz for visualization -->
  <node if="$(arg debug)" 
        name="rviz_phase2" 
        pkg="rviz" 
        type="rviz" 
        args="-d $(find panda_moveit_config)/launch/moveit.rviz" />

  <!-- Instructions -->
  <node name="phase2_instructions" 
        pkg="rostopic" 
        type="rostopic" 
        args="echo /grasp_planning_status" 
        output="screen" 
        if="$(arg debug)" />

</launch>
